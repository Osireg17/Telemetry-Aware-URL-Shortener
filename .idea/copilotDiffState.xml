<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/urlshortener/events/EventValidator.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/urlshortener/events/EventValidator.java" />
              <option name="originalContent" value="package com.urlshortener.events;&#10;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#10;import com.fasterxml.jackson.databind.JsonNode;&#10;import jakarta.validation.ConstraintViolation;&#10;import jakarta.validation.Validator;&#10;import jakarta.validation.ValidatorFactory;&#10;import jakarta.validation.Validation;&#10;import java.time.format.DateTimeFormatter;&#10;import java.time.OffsetDateTime;&#10;import java.util.Set;&#10;&#10;public class EventValidator {&#10;    private final ObjectMapper objectMapper;&#10;    private final Validator validator;&#10;    &#10;    public EventValidator() {&#10;        this.objectMapper = new ObjectMapper();&#10;        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();&#10;        this.validator = factory.getValidator();&#10;    }&#10;    &#10;    public EventValidator(ObjectMapper objectMapper) {&#10;        this.objectMapper = objectMapper;&#10;        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();&#10;        this.validator = factory.getValidator();&#10;    }&#10;&#10;    public boolean isValidClickEvent(String jsonMessage) {&#10;        try {&#10;            parseAndValidate(jsonMessage);&#10;            return true;&#10;        } catch (ValidationException e) {&#10;            return false;&#10;        }&#10;    }&#10;&#10;    public ClickEvent parseAndValidate(String jsonMessage) throws ValidationException {&#10;        if (jsonMessage == null || jsonMessage.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;JSON message cannot be null or empty&quot;);&#10;        }&#10;&#10;        try {&#10;            // Parse JSON to ClickEvent object&#10;            ClickEvent clickEvent = objectMapper.readValue(jsonMessage, ClickEvent.class);&#10;            &#10;            // Validate using Jakarta validation annotations&#10;            Set&lt;ConstraintViolation&lt;ClickEvent&gt;&gt; violations = validator.validate(clickEvent);&#10;            if (!violations.isEmpty()) {&#10;                StringBuilder sb = new StringBuilder(&quot;Validation failed: &quot;);&#10;                for (ConstraintViolation&lt;ClickEvent&gt; violation : violations) {&#10;                    sb.append(violation.getPropertyPath()).append(&quot; &quot;).append(violation.getMessage()).append(&quot;; &quot;);&#10;                }&#10;                throw new ValidationException(sb.toString());&#10;            }&#10;            &#10;            // Additional custom validations&#10;            validateLinkId(clickEvent.getLinkId());&#10;            validateShortCode(clickEvent.getShortCode());&#10;            validateTimestamp(clickEvent.getTimestamp());&#10;            &#10;            return clickEvent;&#10;            &#10;        } catch (Exception e) {&#10;            if (e instanceof ValidationException) {&#10;                throw e;&#10;            }&#10;            throw new ValidationException(&quot;Failed to parse JSON message: &quot; + e.getMessage(), e);&#10;        }&#10;    }&#10;    &#10;    private void validateLinkId(Long linkId) throws ValidationException {&#10;        if (linkId == null) {&#10;            throw new ValidationException(&quot;LinkId cannot be null&quot;);&#10;        }&#10;        if (linkId &lt;= 0) {&#10;            throw new ValidationException(&quot;LinkId must be a positive number, got: &quot; + linkId);&#10;        }&#10;    }&#10;    &#10;    private void validateShortCode(String shortCode) throws ValidationException {&#10;        if (shortCode == null || shortCode.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;ShortCode cannot be null or empty&quot;);&#10;        }&#10;    }&#10;    &#10;    private void validateTimestamp(String timestamp) throws ValidationException {&#10;        if (timestamp == null || timestamp.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;Timestamp cannot be null or empty&quot;);&#10;        }&#10;        &#10;        try {&#10;            // Validate ISO-8601 format&#10;            OffsetDateTime.parse(timestamp, DateTimeFormatter.ISO_OFFSET_DATE_TIME);&#10;        } catch (Exception e) {&#10;            try {&#10;                // Try parsing as ISO_LOCAL_DATE_TIME with 'Z' suffix&#10;                if (timestamp.endsWith(&quot;Z&quot;)) {&#10;                    OffsetDateTime.parse(timestamp, DateTimeFormatter.ISO_INSTANT);&#10;                } else {&#10;                    // Try parsing as local date time&#10;                    OffsetDateTime.parse(timestamp + &quot;Z&quot;, DateTimeFormatter.ISO_INSTANT);&#10;                }&#10;            } catch (Exception e2) {&#10;                throw new ValidationException(&quot;Timestamp must be in ISO-8601 format, got: &quot; + timestamp, e);&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.urlshortener.events;&#10;&#10;import com.fasterxml.jackson.databind.ObjectMapper;&#10;import com.fasterxml.jackson.databind.JsonNode;&#10;import jakarta.validation.ConstraintViolation;&#10;import jakarta.validation.Validator;&#10;import jakarta.validation.ValidatorFactory;&#10;import jakarta.validation.Validation;&#10;import java.time.format.DateTimeFormatter;&#10;import java.time.OffsetDateTime;&#10;import java.util.Set;&#10;&#10;public class EventValidator {&#10;    private final ObjectMapper objectMapper;&#10;    private final Validator validator;&#10;    &#10;    public EventValidator() {&#10;        this.objectMapper = new ObjectMapper();&#10;        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();&#10;        this.validator = factory.getValidator();&#10;    }&#10;    &#10;    public EventValidator(ObjectMapper objectMapper) {&#10;        this.objectMapper = objectMapper;&#10;        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();&#10;        this.validator = factory.getValidator();&#10;    }&#10;&#10;    public boolean isValidClickEvent(String jsonMessage) {&#10;        try {&#10;            parseAndValidate(jsonMessage);&#10;            return true;&#10;        } catch (ValidationException e) {&#10;            return false;&#10;        }&#10;    }&#10;&#10;    public ClickEvent parseAndValidate(String jsonMessage) throws ValidationException {&#10;        if (jsonMessage == null || jsonMessage.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;JSON message cannot be null or empty&quot;);&#10;        }&#10;&#10;        try {&#10;            // Parse JSON to ClickEvent object&#10;            ClickEvent clickEvent = objectMapper.readValue(jsonMessage, ClickEvent.class);&#10;            &#10;            // Validate using Jakarta validation annotations&#10;            Set&lt;ConstraintViolation&lt;ClickEvent&gt;&gt; violations = validator.validate(clickEvent);&#10;            if (!violations.isEmpty()) {&#10;                StringBuilder sb = new StringBuilder(&quot;Validation failed: &quot;);&#10;                for (ConstraintViolation&lt;ClickEvent&gt; violation : violations) {&#10;                    sb.append(violation.getPropertyPath()).append(&quot; &quot;).append(violation.getMessage()).append(&quot;; &quot;);&#10;                }&#10;                throw new ValidationException(sb.toString());&#10;            }&#10;            &#10;            // Additional custom validations&#10;            validateLinkId(clickEvent.getLinkId());&#10;            validateShortCode(clickEvent.getShortCode());&#10;            validateTimestamp(clickEvent.getTimestamp());&#10;            &#10;            return clickEvent;&#10;            &#10;        } catch (Exception e) {&#10;            if (e instanceof ValidationException) {&#10;                throw e;&#10;            }&#10;            throw new ValidationException(&quot;Failed to parse JSON message: &quot; + e.getMessage(), e);&#10;        }&#10;    }&#10;    &#10;    private void validateLinkId(Long linkId) throws ValidationException {&#10;        if (linkId == null) {&#10;            throw new ValidationException(&quot;LinkId cannot be null&quot;);&#10;        }&#10;        if (linkId &lt;= 0) {&#10;            throw new ValidationException(&quot;LinkId must be a positive number, got: &quot; + linkId);&#10;        }&#10;    }&#10;    &#10;    private void validateShortCode(String shortCode) throws ValidationException {&#10;        if (shortCode == null || shortCode.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;ShortCode cannot be null or empty&quot;);&#10;        }&#10;    }&#10;    &#10;    private void validateTimestamp(String timestamp) throws ValidationException {&#10;        if (timestamp == null || timestamp.trim().isEmpty()) {&#10;            throw new ValidationException(&quot;Timestamp cannot be null or empty&quot;);&#10;        }&#10;        &#10;        try {&#10;            // Validate ISO-8601 format&#10;            OffsetDateTime.parse(timestamp, DateTimeFormatter.ISO_OFFSET_DATE_TIME);&#10;        } catch (Exception e) {&#10;            try {&#10;                // Try parsing as ISO_LOCAL_DATE_TIME with 'Z' suffix&#10;                if (timestamp.endsWith(&quot;Z&quot;)) {&#10;                    OffsetDateTime.parse(timestamp, DateTimeFormatter.ISO_INSTANT);&#10;                } else {&#10;                    // Try parsing as local date time&#10;                    OffsetDateTime.parse(timestamp + &quot;Z&quot;, DateTimeFormatter.ISO_INSTANT);&#10;                }&#10;            } catch (Exception e2) {&#10;                throw new ValidationException(&quot;Timestamp must be in ISO-8601 format, got: &quot; + timestamp, e);&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>